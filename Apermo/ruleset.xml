<?xml version="1.0"?>
<ruleset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" name="Apermo" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/PHPCSStandards/PHP_CodeSniffer/master/phpcs.xsd">
	<description>Shared WordPress coding standards by Apermo.</description>

	<!-- Check PHP Version -->
	<config name="testVersion" value="8.3-"/>
	<rule ref="PHPCompatibilityWP">
		<include-pattern>*\.php$</include-pattern>
	</rule>

	<!-- Superseded by Apermo.PHP.ExplainCommentedOutCode. -->
	<rule ref="Squiz.PHP.CommentedOutCode.Found">
		<severity>0</severity>
	</rule>

	<!-- WordPress Ruleset -->
	<rule ref="WordPress">
		<!-- We use short array syntax. -->
		<exclude name="Universal.Arrays.DisallowShortArraySyntax.Found"/>
		<!-- Superseded by Apermo.Formatting.ConsistentAssignmentAlignment. -->
		<exclude name="Generic.Formatting.MultipleStatementAlignment.NotSameWarning"/>
		<!-- Superseded by Apermo.Arrays.ConsistentDoubleArrowAlignment. -->
		<exclude name="WordPress.Arrays.MultipleStatementAlignment.DoubleArrowNotAligned"/>
		<!-- We allow the use short ternary operators. -->
		<exclude name="Universal.Operators.DisallowShortTernary.Found"/>
		<!-- We disallow Yoda conditions. -->
		<exclude name="WordPress.PHP.YodaConditions"/>
		<!-- We allow short open tags. -->
		<exclude name="Generic.PHP.DisallowShortOpenTag.EchoFound"/>
		<!-- We allow short open tags. -->
		<exclude name="Squiz.PHP.EmbeddedPhp.ShortOpenEchoNoSemicolon"/>

		<!-- Filename rules are still open for discussion. -->
		<exclude name="WordPress.Files.FileName.InvalidClassFileName"/>
		<exclude name="WordPress.Files.FileName.NotHyphenatedLowercase"/>

		<!-- Excluded in favour of the YoastCS native FileComment sniff. -->
		<exclude name="Squiz.Commenting.FileComment"/>
		<exclude name="Yoast.Commenting.FileComment.IncorrectAuthor"/>
		<exclude name="Yoast.Commenting.FileComment.IncorrectCopyright"/>
		<exclude name="Yoast.Commenting.FileComment.MissingAuthorTag"/>
		<exclude name="Yoast.Commenting.FileComment.MissingSubpackageTag"/>
		<exclude name="Yoast.Commenting.FileComment.MissingCopyrightTag"/>
		<exclude name="Yoast.Commenting.FileComment.PackageTagOrder"/>
		<exclude name="Yoast.Commenting.FileComment.SubpackageTagOrder"/>
		<exclude name="Yoast.Commenting.FileComment.AuthorTagOrder"/>
		<exclude name="Yoast.Commenting.FileComment.CopyrightTagOrder"/>
	</rule>

	<!-- Superseded by Apermo.PHP.RequireNotInclude. -->
	<rule ref="PEAR.Files.IncludingFile.UseRequire">
		<severity>0</severity>
	</rule>
	<rule ref="PEAR.Files.IncludingFile.UseRequireOnce">
		<severity>0</severity>
	</rule>

	<!-- Disallow long array syntax. -->
	<rule ref="Generic.Arrays.DisallowLongArraySyntax">
		<severity>10</severity>
	</rule>

	<!-- Enforce elseif over else if (PSR2 default is a warning, we want an error). -->
	<rule ref="PSR2.ControlStructures.ElseIfDeclaration">
		<type>error</type>
	</rule>

	<!-- Unconditional if statements (if(true)) should be errors, not warnings. -->
	<rule ref="Generic.CodeAnalysis.UnconditionalIfStatement">
		<type>error</type>
	</rule>

	<!-- Disallow Yoda conditions. -->
	<rule ref="Generic.ControlStructures.DisallowYodaConditions"/>

	<!-- Enforce concatenation operators at start of line in multi-line. -->
	<rule ref="Universal.Operators.ConcatPosition"/>

	<!-- Forbid long closures. Use named functions instead. -->
	<rule ref="Universal.FunctionDeclarations.NoLongClosures">
		<properties>
			<property name="maxLines" value="5"/>
		</properties>
		<exclude name="Universal.FunctionDeclarations.NoLongClosures.ExceedsRecommended"/>
	</rule>

	<!-- Forbid function-based type casts — use (int), (float), (string), (bool) casts instead. -->
	<rule ref="Generic.PHP.ForbiddenFunctions">
		<properties>
			<property name="forbiddenFunctions" type="array">
				<element key="sizeof" value="count"/>
				<element key="delete" value="unset"/>
				<element key="intval" value="(int) cast"/>
				<element key="floatval" value="(float) cast"/>
				<element key="strval" value="(string) cast"/>
				<element key="boolval" value="(bool) cast"/>
			</property>
		</properties>
	</rule>

	<!-- Enforce return types, including void -->
	<rule ref="SlevomatCodingStandard.TypeHints.ReturnTypeHint">
		<properties>
			<property name="enableObjectTypeHint" value="true"/>
			<property name="enableMixedTypeHint" value="true"/>
		</properties>
		<exclude name="SlevomatCodingStandard.TypeHints.ReturnTypeHint.MissingTraversableTypeHintSpecification"/>
		<exclude-pattern phpcbf-only="true"/>
	</rule>

	<!-- Enforce type hints for function parameters -->
	<rule ref="SlevomatCodingStandard.TypeHints.ParameterTypeHint">
		<properties>
			<property name="enableObjectTypeHint" value="true"/>
			<property name="enableMixedTypeHint" value="true"/>
		</properties>
		<exclude name="SlevomatCodingStandard.TypeHints.ParameterTypeHint.MissingTraversableTypeHintSpecification"/>
		<exclude-pattern phpcbf-only="true"/>
	</rule>

	<!-- Enforce type hints for class properties -->
	<rule ref="SlevomatCodingStandard.TypeHints.PropertyTypeHint">
		<exclude name="SlevomatCodingStandard.TypeHints.PropertyTypeHint.MissingTraversableTypeHintSpecification"/>
		<exclude name="SlevomatCodingStandard.TypeHints.PropertyTypeHint.UselessAnnotation"/>
		<exclude name="SlevomatCodingStandard.TypeHints.ReturnTypeHint.UselessAnnotation"/>
		<exclude-pattern phpcbf-only="true"/>
	</rule>

	<!-- Enforce alphabetically ordered import use statements. -->
	<rule ref="SlevomatCodingStandard.Namespaces.AlphabeticallySortedUses">
		<properties>
			<property name="psr12Compatible" value="true"/>
			<property name="caseSensitive" value="false"/>
		</properties>
	</rule>

	<!-- Disallow unused import use statements. -->
	<rule ref="SlevomatCodingStandard.Namespaces.UnusedUses">
		<properties>
			<property name="searchAnnotations" value="true"/>
		</properties>
	</rule>

	<!-- For namespaced functions/constants: import the namespace, not the function/constant. -->
	<rule ref="Universal.UseStatements.DisallowUseConst"/>
	<rule ref="Universal.UseStatements.DisallowUseFunction"/>

	<rule ref="PSR1.Classes.ClassDeclaration"/>

	<!-- Discourage stdClass usage — use typed classes instead. -->
	<rule ref="SlevomatCodingStandard.PHP.ForbiddenClasses">
		<properties>
			<property name="forbiddenClasses" type="array">
				<element key="\stdClass" value="null"/>
			</property>
		</properties>
		<type>warning</type>
	</rule>
</ruleset>
